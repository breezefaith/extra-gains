DROP TABLE "BOOK_AUTHORS";
DROP TABLE "BOOK_COPIES";
DROP TABLE "BOOK_LOANS";
DROP TABLE "BOOKS";
DROP TABLE "BORROWERS";
DROP TABLE "BRANCHES";
DROP TABLE "PUBLISHERS";

CREATE TABLE "BOOK_AUTHORS" (
  "BOOK_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "AUTHOR_NAME" VARCHAR2(255 BYTE) VISIBLE NOT NULL
);

CREATE TABLE "BOOK_COPIES" (
  "BOOK_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "BRANCH_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "no_of_copies" NUMBER VISIBLE
);


CREATE TABLE "BOOK_LOANS" (
  "BOOK_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "BRANCH_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "CARD_NO" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "date_out" DATE VISIBLE,
  "date_due" DATE VISIBLE,
  "date_returned" DATE VISIBLE
);


CREATE TABLE "BOOKS" (
  "BOOK_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "title" VARCHAR2(255 BYTE) VISIBLE,
  "publisher_name" VARCHAR2(255 BYTE) VISIBLE
);


CREATE TABLE "BORROWERS" (
  "CARD_NO" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "name" VARCHAR2(255 BYTE) VISIBLE,
  "address" VARCHAR2(255 BYTE) VISIBLE,
  "phone" VARCHAR2(255 BYTE) VISIBLE,
  "unpaid_dues" NUMBER(38,2) VISIBLE
);


CREATE TABLE "BRANCHES" (
  "BRANCH_ID" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "branch_name" VARCHAR2(255 BYTE) VISIBLE,
  "address" VARCHAR2(255 BYTE) VISIBLE
);


CREATE TABLE "PUBLISHERS" (
  "NAME" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "address" VARCHAR2(255 BYTE) VISIBLE,
  "phone" VARCHAR2(255 BYTE) VISIBLE
);

CREATE TRIGGER "BEFORE_ADD_BOOK_LOANS" BEFORE INSERT ON "BOOK_LOANS" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW
BEGIN
  :NEW."date_out" := sysdate;
END;
/

ALTER TABLE "BOOK_AUTHORS" ADD PRIMARY KEY ("BOOK_ID", "AUTHOR_NAME");

ALTER TABLE "BOOK_AUTHORS" ADD CHECK ("BOOK_ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "BOOK_AUTHORS" ADD CHECK ("AUTHOR_NAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOK_COPIES" ADD PRIMARY KEY ("BOOK_ID", "BRANCH_ID");

ALTER TABLE "BOOK_COPIES" ADD CHECK ("BOOK_ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "BOOK_COPIES" ADD CHECK ("BRANCH_ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOK_LOANS" ADD PRIMARY KEY ("BOOK_ID", "BRANCH_ID", "CARD_NO");

ALTER TABLE "BOOKS" ADD PRIMARY KEY ("BOOK_ID");

ALTER TABLE "BOOKS" ADD CHECK ("BOOK_ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BORROWERS" ADD PRIMARY KEY ("CARD_NO");

ALTER TABLE "BRANCHES" ADD PRIMARY KEY ("BRANCH_ID");

ALTER TABLE "BRANCHES" ADD CHECK ("BRANCH_ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "PUBLISHERS" ADD PRIMARY KEY ("NAME");

ALTER TABLE "PUBLISHERS" ADD CHECK ("NAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOK_AUTHORS" ADD FOREIGN KEY ("BOOK_ID") REFERENCES "BOOKS" ("BOOK_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOK_COPIES" ADD FOREIGN KEY ("BOOK_ID") REFERENCES "BOOKS" ("BOOK_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "BOOK_COPIES" ADD FOREIGN KEY ("BRANCH_ID") REFERENCES "BRANCHES" ("BRANCH_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOK_LOANS" ADD FOREIGN KEY ("BOOK_ID") REFERENCES "BOOKS" ("BOOK_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "BOOK_LOANS" ADD FOREIGN KEY ("BRANCH_ID") REFERENCES "BRANCHES" ("BRANCH_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "BOOK_LOANS" ADD FOREIGN KEY ("CARD_NO") REFERENCES "BORROWERS" ("CARD_NO") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

ALTER TABLE "BOOKS" ADD FOREIGN KEY ("publisher_name") REFERENCES "PUBLISHERS" ("NAME") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;